#还没有复习 

# 对称密码（ 共享密钥密码 ) 
用相同的密钥进行加密和解密


## 加解密算法中的位运算

加解密算法中常用异或运算 ⊕（没有进位的加法运算） 对明文进行运算

异或运算有如下特点

A ⊕ B = C，C ⊕ B = A

如果把 A 当作明文，B 是密钥，C 是密文

那让密文和密钥进行异或运算就能还原出明文

这明示了异或运算能实现对称密码对密钥能加明文也能解密密文的要求

![Pasted image 20220602160821](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220602160821.png)


如果 C 的选值足够好，那么 A 经过和 B 的异或运算后，C 会掩盖掉 A 的数据特征，仅用 C 很难计算出 A

当 C 是一串不可预测的随机比特序列时，认为 C 的选值是良好的。C 就是密钥


## 一次性密码本 —— 绝对不会被破译的密码

一次性密码本非常简单，它把明文与一串随机比特序列进行 X0R 运算

密钥长度 = 明文长度 = 密文长度


即使有运算能力无穷大的计算机，它能瞬间尝试密钥空间里的所有密钥也不能破译一次性密码本，**因为无法判断解密后的数据是不是正确的明文**


一次性密码本仅存在于理论上，实际上是不可行的，因为

- 无法保证密钥绝对安全的交换，一旦被窃取就完全失去安全性

- 密钥长度过长，难以保存，且对其压缩的效率极低

- 密钥只能被用一次，难以重复使用



> [!NOTE] 密钥不适合被压缩
> 密钥通常是随机比特序列。而压缩的原理是识别并去掉数据中重复，冗余的部分。但密钥的随机性导致它理论上没有重复，冗余的部分。如果密钥能被压缩，说明它不是一个随机的比特序列


> [!NOTE] 一次性密码本和流密码
> 一次性密码本孕育出了[[流密码和块密码#流密码的定义|流密码]]


## DES，3-DES和加密轮


> [!WARNING] 
> 现在 DES 已经能在短时间内被暴力破解，因此除用它来解密以前的密文以外，现在我们不应该再使用 DES 了

DES 是分组密码算法，一个分组 64 位，密钥也是 64 位，密钥每次只能对 64 位的明文加密。如果明文的长度超过 64 位就需要对 DES 加密进行迭代（ 反复 ）， 而迭代的具体方式就称为 模式

DES 加密明文的过程就是进行若干次轮的循环，一轮表示加密的一个完整子过程，下图表示 DES 加密的一轮

![Pasted image 20220603094851](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603094851.png)

DES 的加密需要 16 轮，且为保证输入的 64 比特的左右侧都能被加密，每轮都会交换左右侧的相对位置

![Pasted image 20220603095220](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603095220.png)



> [!NOTE] Feistel 网络
> DES 中这种每轮交换左右侧的行为构成的执行流程被称为 Feistel 网络


DES 是对称密码，所以解密过程是加密过程的逆过程


> [!NOTE] 子密钥和轮函数
> 直接对数据进行加密的不是子密钥，而是子密钥经过轮函数计算后得到的局部密钥

由于 DES 已经能被暴力破解，所以发展出了三重 DES，它增强了 DES 的强度，但其处理速度不高， 而且在安全性方面也出了一些问题

![Pasted image 20220603100020](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603100020.png)

## AES 和 Rijndael

AES 是一个对称密码的标准，多个候选算法竞争后，Rijndael 被认可，并作为 AES 标准的实现，所以现在 AES = Rijndael

AES 的分组长度有多个可选项，有 128 、 192 和 256 比特三种。AES 的加解密过程需要进行 10~14轮，现在假设分组长度为 128，其加密的一轮过程如下图


![Pasted image 20220603102046](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603102046.png)

解密的一轮如下图

![Pasted image 20220603102122](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603102122.png)


> [!INFO] AES 的优点
> AES（Rijndael）安全、快速，而且能够在各种平台上工作。虽然从明文到密文的计算过程可以全部用公式表达，但目前还未找到有效的攻击手段

# 分组密码的模式 —— 分组密码是如何迭代的

DES 和 AES 都属于[[流密码和块密码#块密码的定义|分组密码]]，每次能加密数据的位数 = 密钥位数。如果需要加密任意长度的明文，就需要对分组密码进行迭代，分组密码的迭代方法就称为分组密码的 “模式”

除 ECB 外，其他模式中，每次分组加密都会参考上次分组加密的结果。这样就能保证对像 "abcabcabc..." 这种有循环特征，或某些组合重复出现的数据加密时能得到不同的加密结果


模式有很多种，主要有以下几种方式

- ECB 模式： Electronic CodeBook mode ( 电子密码本模式 ）  
- CBC 模式： Cipher Block Chaining mode ( 密码分组链接模式 ）  
- CFB 模式： Cipher FeedBack mode ( 密文反馈模式 ）  
- OFB 模式： Output FeedBack mode ( 输出反馈模式 ）  
- CTR 模式： CounTeRmode ( 计数器模式 ）

下面把 “用分组密码算法加密一个分组” 简写为 “加密”


## ECB 电子密码本模式
每次都用相同的密钥加密分组

![Pasted image 20220603141446](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603141446.png)

当最后一个明文分组的内容小于分组长度时，需要用一些特定的数据进行填充

缺点非常致命：相同的明文分组加密后得到的密文分组也相同；不能隐藏数据特征

## CBC 密码分组链接模式

上一次加密得到的密文分组作为下一组加密密钥的依据

![Pasted image 20220603142125](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603142125.png)

初始化向量是随机数，长度和分组长度相同

## CFB 密文反馈模式

上一次加密得到的密文分组作为下一组加密密钥的依据

![Pasted image 20220603144036](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603144036.png)

因为密文是用明文和比特序列进行 XOR 运算得到的，且这些比特序列随机性强，所以这和一次性密码本很像，因此可以将 CFB 模式看做是一种使用分组密码来实现流密码的方式

## OFB 输出反馈模式

对密钥进行多次加密，每次加密后就作为加密密文的密钥用

![Pasted image 20220603145231](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603145231.png)


OFB 模式下每次加解密依赖的密钥都可以提前准备好，这样就能并行执行多个分组的加解密，速度极快


## CTR 计数器模式

和 OFB 很像，对原密钥累加 1 后加密作为下次分组加密的密钥

![Pasted image 20220603145429](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603145429.png)

CTR 模式是一种流密码，也能进行并行执行多个分组的加解密，速度快。和 OFB 不同的是，CTR 可以以任意顺序对分组进行加密和解密，因为每个分组用的计数器的值可直接用偏移量算出来，OFB 中每个密文分组用的密钥必须依赖上一个密文分组用的密钥

每次加密时都会生成一个不同的值（ nonce ) 来作为计数器的初始值


## 推荐使用 CBC 和 CTR

上述几种模式中，除了加密过程中用到的密钥外，为了支持分组迭代加密又引入了 “初始化向量” 或 “计数器” 的概念，他们本质上都是一个仅用于一次加密的临时密钥，也是随机数

在上面几种模式中，现在仅推荐用  CBC 和 CTR

![Pasted image 20220603150016](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603150016.png)![Pasted image 20220603150041](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220603150041.png)


# 公钥密码 —— 用公钥加密， 用私钥解密


> [!NOTE] 非对称密钥对中任意一个密钥都能用于加密，另一个密钥解密


在用对称密钥保证数据安全性时，需要让通信双方都持有此次会话的对称密钥。如果对称密钥由通信的某一方生成，并传递给另一方，就需要先保证对称密钥的传输是安全的

公钥密码加解密效率低，所以通常不用公钥密码加密数据。当用对称密码加解密数据时，需要保证对称密钥的安全共享。公钥密码常作为共享对称密钥的手段，通过加密并传输对称密钥达到安全共享的目的


## 简述对称密码的密钥配送问题及其解决方案

对称密码的难点在于密钥的安全传输，密钥安全传输方式有以下几种


| 解决方案                | 执行流程                                                           | 缺点                                           |
| ----------------------- | ------------------------------------------------------------------ | ---------------------------------------------- |
| 事先共享密钥            | 通信双方线下传递密钥                                               | 不方便，且当通信会话变多时管理密钥的难度也变大 |
| 密钥分配中心            | 密钥分配中心生成临时会话密钥并交给通信双方                         | 密钥分配中心宕机则所有通信均不再安全           |
| Diffie-Hellman 密钥交换 | 通信前双方交换允许被窃听的信息，只有通信双方才能用这些信息生成密钥 | 稍后讨论                                       |
| 公钥密码                | 发送端用公钥加密密钥，只有接收端才能用私钥解密被加密的密钥         | 稍后讨论                                       |


## 公钥密钥共享对称密钥时的公钥认证问题

用公钥密码通信前，Bob 需要把公钥分享给 Alice

![Pasted image 20220626135440](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626135440.png)


上述通信的问题在于 Alice 想和 Bob 通信，但 Alice 并不能确定收到的公钥就是 Bob 的，这叫**公钥认证**，这个问题稍后再解决

## RSA 对称加解密算法

RSA 是一种被广泛应用的公钥密码算法


### 加密
RSA 的加密公式为

```
密文 = 明文 E mod N ( RSA 加密 )
```

密文 = 明文的 E 次方结果，再对结果取 N 的模。所以 E 和 N 的组合就是公钥


### 解密

```
明文 = 密文 D mod N ( RSA 解密 )
```

当 D 足够长时，暴力破解不可能在有限时间内破解出 D


RSA 的破解难度来自于：对大整数进行质因数分解十分困难这一数学理论实时

![Pasted image 20220626140416](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626140416.png)

## 公钥认证导致的中间人攻击

Alice 想要和 Bob 通信时，攻击者夹在两者中间。攻击者伪装为 Bob 对 Alice 建立通信，同时又伪装为 Alice 对 Bob 建立通信

攻击者收到双方发送的数据时会恶意篡改内容再转发给接收方

![Pasted image 20220626141047](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626141047.png)

会产生上述的问题在于，Alice 和 Bob 想要建立通信传递通信公钥时，攻击者拦截到了这个公钥并替换为自己的公钥后交给 Alice 或 Bob。所以如果通信方收到公钥后能验证公钥是否来自于真正的对端就能防止这一问题，这叫做**公钥认证**，可以用**公钥证书**实现



# 混合密码系统 —— 用对称密码提高速度，用公钥密码保护会话密钥

## 两种密码抵御暴力破解的能力比较

具备同等抵御暴力破解强度的密钥长度比较如下图

![Pasted image 20220626141701](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626141701.png)


同等长度的密钥中，对称密码低于暴力破解的强度要比公钥密码高的多


## 公钥密码的缺点

- 公钥密码的处理速度远远低于对称密码

- 公钥密码难以抵御中间人攻击


> [!NOTE] Title
> 一般来说， 在采用具备同等机密性的密钥长度的情况下，公钥密码的处理速度只有对称密码的几百分之一。 因此，公钥密码并不适合用来对很长的消息内容进行加密


## 混合密码加密方式

简言之，先用公钥密码作为加密密钥的手段，传输对称密码的密钥。再用对称密码作为通信信息的加密手段，加密会话中的信息

![Pasted image 20220626142214](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626142214.png)

会话密钥是为本次通信而生成的临时密钥。会话密钥是对称密码的密钥，同时也是公钥密码的明文

上述加密过程中，会话密钥和消息被不同的加密方式加密过后组合到一个密文里了。但密钥传递和消息传递其实是可以分离的，比如 HTTPS 链接


## 混合密码解密方式

简言之，接收方用私钥解密被加密的会话密钥，再用会话密钥解密被加密的通信信息

![Pasted image 20220626142652](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220626142652.png)

## 搭建高强度的混合密码系统

上述混合密码系统的加解密流程中，会话密钥（也就是对称密码的密钥）由伪随机生成器生成

混合密码系统中运用了对称密码和公钥密码两种密码方式，无论其中任何一方的密钥过短，都可能遭到集中攻击， 因此对称密码和公钥密码的密钥长度必须具备同等的强度

然而，考虑到长期运用的情况，公钥密码的强度应该要高于对称密码，因为对称密码的会话密钥被破译只会影响本次通信的内容，而公钥密码一旦被破译，从过去到未来的（ 用相同公钥加密的 ）所有通信内容就都能够被破译了