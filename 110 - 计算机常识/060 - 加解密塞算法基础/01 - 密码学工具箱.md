# 概要和知识地图


密码技术是多种技术的总称，每种技术都能为数据提供一些特性（机密性，完整性，认证，防否认等）


## 密码技术中的主要角色

为了在例子中更生动地描述密码技术的使用常见，定义如下存在于例子中的角色

![Pasted image 20220601224400](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220601224400.png)
			
- 窃听者，攻击者，验证者等都可能不是人类，而是运行中的程序
- 接收者以外的其他人试图将密文还原为明文，称为 `密码破译`、`破译` 或 `密码分析`
- 进行破译的人称为破译者，破译者并不一定是坏人


## 信息安全面临的威胁与应对威胁的密码技术

场景：Alice 向 Bob 发送一封邮件

![Pasted image 20220601225231](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220601225231.png)

上述邮件传输过程是不安全的，因为数据传输过程中可能存在以下问题


- Q1：Eve 窃听到数据后破译密文
- Q2：Mallory 篡改 Alice 的数据后发送给 Bob
- Q3：Mallory 伪装为 Alice 后和 Bob 通信
- Q4：Alice 不承认自己发送过的 msg


通常来说，不能防止 Eve 窃听通信内容

但即使内容被窃听也能用下列手段保证安全通信

- A1：加解密算法 = 机密性
- A2：单向散列函数 = 完整性（感知消息是否被篡改）
- A3：消息认证码 =  完整性 + 认证（检查消息发送方是不是伪装者）
- A4：数字签名 = 完整性 + 认证 + 防止事后否认

> [!NOTE] 密码技术的其他使用场景
> 除了两个人互相发送数据外的场景需要密码技术提供支持外，密码技术还可以被用在其他常见下
> 
> 比如 Alice 创建的数据，要求只能被 Alice 读取。
> 
> 这需要保证数据不能被破译，感知到数据是否被他人篡改过


信息安全所面临的威胁与用来应对这些威胁的密码技术之间的关系如下

![Pasted image 20220601231927](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220601231927.png)


## 密码与信息安全常识

- 不要使用保密的密码算法

- 使用低强度的密码比不进行任何加密更危险  

- 任何密码总有一天都会被破解  

- 密码只是信息安全的一部分

不要使用保密的密码算法，因为**密码算法的秘密早晚会公诸于世**，**开发高强度的密码算法是非常困难的**，所以一旦密码算法被暴露，算法将有很大概率被快速破解

这种试图通过对密码算法本身进行保密来确保安全性的行为， 一般称为**隐蔽式安全性**。这种行为很危险


密码只是信息安全的一部分，通过人类的社会行为，通过偷窃，欺骗等手段也能获取到明文。这些手段和密码算法强度无关，但也是信息安全的一部分



# 加解密算法和破译方法的基本概念

本章所介绍的密码在现代都已经不再使用了，但在寻找密码弱点的方法 、破译密码的思路以及密码算法与密钥的关系等方面， 这些密码与现代的密码技术依然是相通的

## 恺撒密码

恺撒密码通过将明文中所使用的字母表按照一定的字数 “平移” 来进行加密

假设字母加密过程就是被平移 3 个字母，那么得到如下字典表

![Pasted image 20220602101506](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220602101506.png)

比如："abc" 加密后变为 "DEF"

**密钥就是 3**

加密者和解密者都需要知道算法种类是 “凯撒算法”，密钥是 3 后才能进行加解密

## 暴力破译破解凯撒密码

暴力破译又称穷举搜索

对于凯撒密码来说，破译需要进行 26 种尝试。因为密钥的取值范围为 0~25


## 简单替换密码

“凯撒密码” 的加解密过程是对字母进行 “平移”，使得每个字母都能映射到另一个字母。但这种映射是有规律的

简单替换密码用的映射表是没有规律的，比如下图所示的字典表

![Pasted image 20220602104919](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220602104919.png)

简化以后得到

![Pasted image 20220602120735](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220602120735.png)

字典表的排列组合方式有 26! 种，也就是说，暴力破译要破解简单替换密码需要进行 26! 次尝试

因此，简单替换密码很难通过暴力破解来破译


> [!NOTE] 凯撒密码是简单替换密码的特殊情况


## 频率分析法破译简单替换密码

频率分析利用了明文中的字母的出现频率与密文中的字母的出现频率一致这一特性

**工作原理**

场景：假设明文是用英语写的，那么明文内容一定遵守英语语法，每个单词也一定都是现存的单词。密文采用简单替换密码加密

**工作方式**：
- 分析现有的单词库，和大量的英文文章。计算出词频数高的单词，字母频数高的字母
- 分析密文中的字母频数，把密文中字母频数高的字母替换为明文形式下英文文章中字母频数高的字母
- 分析密文中词频数，根据密文中词频数高的词出现的位置，长度等信息，尝试将其替换为合适的单词，并在这个过程中尝试确定简单密码替换的字典表


根据上述工作方式得出以下结论

- 高频字母，低频字母都能够成为破译线索
- 搞清开头和结尾能够成为线索， 搞清单词之间的分隔也能够成为线索
- 密文越长越容易破译，因为密文越长，可参考的词频，语境就越多
- 同一个字母连续出现能够成为线索（因为在简单替换密码中， 某个字母在替换表中所对应的另一个字母是固定的)


## 密钥和密钥空间

**密钥**

如果把加密过程看作一个函数，函数的行为是已知的，所以如果知道所有参数就能计算出密文

```java
byte[] ciphertext = encryption(data, secret_key);
```

同理，密文解密也是如此

因为加解密算法通常是公开的，所有为了防止密文被破解，保管好密钥很重要


- 在凯撒密码中，密钥是字母平移的偏移量
- 在简单替换密码中，密钥是字母替换表

一旦知道了加密算法的种类和密钥就能破解密文，因此密钥的管理是密码技术的精髓



**密钥空间**


密钥的取值范围又称密钥空间，是密钥值的所有取值的集合，它决定了暴力破译的时间复杂度


> [!NOTE] 两种算法的密钥空间
> - 凯撒密码的密钥空间是 26
> - 简单替换密码的密钥空间是 26!

## Enigma 算法

Enigma 是能进行加解密的机器，要求发送者和接收者必须使用相同的密钥才能够完成加密通信

密钥通常被放在 `密码本` 里，密码本里记载了 `每日密码`。每日密码一天一换

设置密钥：机器根据每日密码，在接线板设置密钥

加密：在输入端（键盘）输入明文，输出端（灯泡）输出密文

解密：在输入端（键盘）输入密文，输出端（灯泡）输出明文


但实际情况下，每日密码并不作为通信密钥

通信密钥的明文 A 由人为规定，并用 Enigma 对每日密码进行加密后传输给对方，对方用相同的每日密码解密 B 得到 A，再用 A 作为通信密钥

再次用 B 作为加密密钥进行通信

![Pasted image 20220602153924](https://wings-liberty.oss-cn-beijing.aliyuncs.com/note/Pasted%20image%2020220602153924.png)


> [!NOTE] 通信密钥明文 A 需要输入两次
> A 被输入两次，再进行加密得到密文 B。如果用每日密码解密 B 后能得到一串类似 "abcabc" 的序列，说明 A 再传输过程中没有被改变
> 
> 之所以这么做是因为当时的通信质量差，这是防止发生通信错误导致通信密钥发生错位的手段


> [!NOTE] 每日密钥和通信密钥的区别
> 
> 通信密钥用于加密通信消息，每日密码仅用于加密通信密钥。每日密码一般被称为 `密钥加密密钥`
> 
> 之所以用两重加密，是因为用同一个密钥所加密的密文越多，被破译的危险性也会相应增加。如果通信密钥 A 泄露，就赶紧再创建一个通信密钥并用每日密码加密传给对方，虽然用 A 加密的数据会被破译，但用新通信密钥加密的数据还是安全的

Enigma 的弱点在于
1. 及其依赖每日密码，如果密码本泄露，在传输通信密钥时就可能被窃听并破解
2. 通信密码的明文是人为定义的，不具有随机性


## 基于通信密钥特点破译 Enigma

Enigma 的通信密码明文需要被输入两次，根据这个特点经过数学分析后的暴力破解能破译通信密码的密文


这种方式是根据加密算法、密钥、密文的特点进行数学分析得出破译方案的分析方法
