之所以说  Kafka 充分利用了  PageCache 理由如下

缓存分为两种

- 读缓存。从磁盘读数据后，缓存一份，以便下次命中缓存，规避磁盘 IO
- 读写缓存。包括了缓存，还添加了：向磁盘更新数据前，先更新缓存，再异步写磁盘

PageCache 就是读写缓存的实现

MQ 的消息多为一收一发，基于 MQ 的特点，MQ 比较适合用读写缓存

读写缓存存在两个缺点

- 实现复杂
- 写数据的顺序是同步写到 Cache，异步写入磁盘。如果写入 Cache 并告诉调用方写成功，结果异步写磁盘失败（比如刚好停电），调用方还以为写成功了。这会导致

因为 PageCache 就是读写缓存的实现，所以 Kafka 用 PageCache 就不用自己实现读写缓存。对于第二个缺点，如果 Kafka 是单机，也会存在这个问题，但 Kafka 通过副本机制规避了这个问题。Kafka 集群里只有当一部分副本都写成功后才会认为消息写成功（应该是这样。虽然其他副本写入时也会用 PageCache，但多个主机都刚好在写入 Cache 后，写入磁盘前停电是不可能事件）

又聊了聊缓存数据一致性问题机制，也是八股文，但好像内容和八股文不一样。不过感觉还是有点偏离主题了



#结束 