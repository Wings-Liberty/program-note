```
- redis宕机了，怎么办？
- redis缓存高峰期键值对却到期，请求会如何处理
- 用户不停查询一条不存在的数据，缓存没有，数据库也没有，会出现什么情况
```



# 缓存穿透

![[../../020 - 附件文件夹/Pasted image 20230402102502.png]]

## 问题描述

缓存穿透是指用户查询数据，在数据库没有，自然在缓存中也不会有。这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空（相当于进行了两次无用的查询）



## 解决方案

- **布隆过滤器**，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。
- （简单粗暴）对空结果进行缓存，并给它一个短暂的过期时间，最长不超过五分钟。这样短时间内，即使再有相同的请求也会暂时不访问数据库



# 缓存雪崩



## 问题描述

缓存雪崩是指在我们设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB瞬时压力过重雪崩



## 解决方案

- 大多数系统设计者考虑用加锁（ 最多的解决方案）或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。
- （简单粗暴）原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件



# 缓存击穿



## 问题描述

对于一些设置了过期时间的key，如果这些key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：如果这个key在大量请求同时进来前正好失效，那么所有对这个key的数据查询都落到db，我们称为缓存击穿


## 解决方案

分布式锁

![[../../020 - 附件文件夹/Pasted image 20230402102523.png|500]]

# 缓存预热



## 问题描述

缓存预热就是系统上线后，将相关的缓存数据直接加载到缓存系统。这样就可以避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题！用户直接查询事先被预热的缓存数据

## 解决方案

1、写个缓存刷新页面，上线时手工操作下

2、数据量不大，可以在项目启动的时候自动进行加载

3、定时刷新缓存



# 缓存更新



除了缓存服务器自带的缓存失效策略之外（`Redis`默认的有6中策略可供选择），我们还可以根据具体的业务需求进行自定义的缓存淘汰，常见的策略有两种：

（1）定时去清理过期的缓存；

（2）当有用户请求过来时，再判断这个请求所用到的缓存是否过期，过期的话就去底层系统得到新数据并更新缓存。

两者各有优劣，第一种的缺点是维护大量缓存的key是比较麻烦的，第二种的缺点就是每次用户请求过来都要判断缓存失效，逻辑相对比较复杂！