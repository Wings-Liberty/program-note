
> [!tip] 参考资料离线备份
> [[../../021 - 离线网页备份文件夹/CompletableFuture原理与实践-外卖商家端API的异步化 - 美团技术团队 (2023_5_21 18_06_43).html|CompletableFuture原理与实践-外卖商家端API的异步化 - 美团技术团队 (2023_5_21 18_06_43)]]

还是用这张图举例子

![[../../020 - 附件文件夹/Pasted image 20230419225752.png|300]]

一个 `CompletableFuture` 对象就是上图里的一个 ”节点“，节点里可能包含了需要执行的 ”任务“，也可能包含了一个 ”网关“ 用于控制是否继续执行下一步（比如上图的 "anyOf" 和 "allOf"）

单独创建一个节点后就会执行节点里的任务，这个不用多说

`CompletableFuture` 控制执行是否继续，以及执行完这个问题时，应该执行哪个任务。这个是用 [[../../021 - 离线网页备份文件夹/设计模式 - 观察者模式.html|设计模式 - 观察者模式]] 实现的

每个节点维护了一个栈（经过改造的栈），里面保存的是节点数组，它们表示了这样的信息：如果我想执行自己，我需要等这些节点都执行完后我才能执行自己

每个节点还维护了 next，当执行完自己的时候就会通知 next

如果节点收到了通知，就会把通知自己的节点从栈里去掉，如果栈空说明可以执行自己了

此外节点还维护了一个状态值，如果执行完后就将其改为 ”执行结束“，执行结束的节点不会被再次执行。这也是为啥用了 ”anuOf“ 后后面的节点不会因为上面有多条分支就执行多次